# Ansible Role: OpenVPN

Эта роль для Ansible настраивает OpenVPN сервер на целевой машине с поддержкой маршрутизации, копированием сертификатов и ключей, а также автоматическим перезапуском OpenVPN после внесения изменений в конфигурацию.

## Поддерживаемые ОС
Ubuntu Server:
- 20.04
- 22.04
- 24.04

## Описание

Роль выполняет следующие действия:

1. **Установка OpenVPN**: Устанавливает OpenVPN и необходимые зависимости на целевой хост.
2. **Включение IP-маршрутизации**: Включает пересылку пакетов (IP forwarding) на целевой машине для поддержки маршрутизации трафика через VPN.
3. **Копирование сертификатов и ключей**: Автоматически копирует необходимые файлы, такие как `ca.crt`, `server.crt`, `server.key`, `dh.pem`, и `ta.key` из директории `files` роли в `/etc/openvpn/`.
4. **Рендеринг конфигурационного файла OpenVPN**: Использует шаблон для динамического создания конфигурации OpenVPN с учетом значений переменных (порт, протокол, IP-адрес и маршрут).
5. **Перезапуск службы OpenVPN**: После изменения конфигурации или копирования сертификатов, роль перезапускает службу OpenVPN, чтобы применить новые настройки.

## Переменные

Следующие переменные должны быть определены для корректной работы роли:

- `openvpn_port`: Порт, на котором OpenVPN будет принимать подключения (по умолчанию `1194`).
- `openvpn_protocol`: Протокол для OpenVPN (например, `udp` или `tcp`).
- `openvpn_ip`: IP-адрес или подсеть для VPN-сервера (например, `10.8.0.0`).
- `openvpn_netmask`: Маска подсети для OpenVPN (например, `255.255.255.0`).
- `openvpn_route`: Маршрут, который должен быть доступен клиентам через VPN (например, `192.168.56.0 255.255.255.0`).

## Файлы

Следующие файлы должны быть размещены в директории `files` роли для примера. В реальной жизни замените их своим экземплярами, сгенерировав их с помощью пакета easyrsa:

- `ca.crt`: Сертификат центра сертификации.
- `server.crt`: Сертификат сервера.
- `server.key`: Приватный ключ сервера.
- `dh.pem`: Параметры Диффи-Хеллмана.
- `ta.key`: TLS-ключ для защиты от атак (tls-auth).

## Шаблоны

- `server.conf.j2`: Шаблон конфигурации OpenVPN, который заполняется значениями переменных и копируется в `/etc/openvpn/server.conf`.

## Пример использования

Пример playbook для использования роли:

```yaml
---
- hosts: vpn_servers
  become: yes
  roles:
    - openvpn
  vars:
    openvpn_port: 1194
    openvpn_protocol: udp
    openvpn_ip: 10.8.0.0
    openvpn_netmask: 255.255.255.0
    openvpn_route: 192.168.56.0 255.255.255.0
```

## Зависимости

Ansible 2.9 или выше.

OpenVPN должен поддерживаться целевой операционной системой (например, Ubuntu).

## Лицензия
MIT